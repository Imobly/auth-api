version: '3.8'

networks:
  default:
    name: imovel_network
    external: true

services:
  auth-api:
    build: .
    container_name: auth-api-prod
    command: uvicorn app.main:app --host 0.0.0.0 --port 8000
    ports:
      - "8001:8000"
    environment:
      ENVIRONMENT: production
      DATABASE_URL: ${DATABASE_URL_PROD}
      # Supabase Production Database
      DB_SCHEMA: ${DB_SCHEMA:-public}
      
      # Security
      SECRET_KEY: ${SECRET_KEY}
      ALGORITHM: ${ALGORITHM:-HS256}
      ACCESS_TOKEN_EXPIRE_MINUTES: ${ACCESS_TOKEN_EXPIRE_MINUTES:-30}
      
      # CORS
      CORS_ORIGINS: ${CORS_ORIGINS}
      
      # Server
      HOST: 0.0.0.0
      PORT: 8000
      DEBUG: ${DEBUG:-false}
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
